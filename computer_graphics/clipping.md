# 裁剪

我们之前一直在处理的限制：透视投影方程只适用于相机前面的点，由于我们现在可以围绕场景移动和旋转相机，就产生了一个
问题：相机后面的点如何处理。

前面我们得到了透视投影方程

![x上的坐标的透视投影方程](../.gitbook/assets/chapter-16image21.jpg)

![y上的坐标的透视投影方程](../.gitbook/assets/chapter-16image22.jpg)

Pz作为除数是有问题的，会出现除以0的现象出现，此外相机后面的点Z的值为负，我们目前无法处理。即使是在相机前面但非常靠近相机的点，也会因为严重扭曲的物体表现形式而造成麻烦。

为了避免这些有问题的情况出现，我们选择不渲染投影平面z=d后面的任何物体。裁剪平面（clipping plane）让我们将任何点分类为裁剪体（clipping volume）的内部（inside）或外部（outside）。`相对于相机而言,由其可见部分组成的空间子集，在这种情况下，裁剪体是z=d前面的任何东西`。我们将只渲染裁剪体内部的这部分场景。

## 裁剪体

不仅仅是视口平面后面的不用渲染，还有就是靠近投影平面，但在相机右侧或左侧很远的物体的投影，会被投影到视口之外。

![位于相机前方但被投影到视口之外的物体](../.gitbook/assets/chapter-16image2.png)

具体的平面如下图所示，想一个被剔除顶部的金字塔。

![定义我们的裁剪体的5个平面](../.gitbook/assets/chapter-16image3.png)

每个裁剪平面将空间分成两部分，称之为半空间 half-space。内部半空间是平面前面的所有东西，外部半空间是它后面的所有
东西。我们定义的裁剪体的内部是每个裁剪平面定义的内部半空间的交集。

## 使用平面裁剪场景

考虑一个包含多个物体的场景，每个物体由4个三角形组成。

![包含3个物体的场景](../.gitbook/assets/chapter-16image4.png)

首先，尝试一次性对整个物体进行分类。如果一个物体完全在裁剪体内部，则它被接受。如果一个物体完全在裁剪体外部，则将其丢弃。

![在物体级别进行裁剪。绿色物体被接受，红色物体被丢弃，灰色物体需要进一步处理](../.gitbook/assets/chapter-16image5.png)

如果一个物体不能被完全接受或丢弃，就进入下一阶段，对它的每个三角形进行独立的分类。
如果三角形完全在裁剪体内部，它是被接受的。如果三角形完全在外部，则将其丢弃。

![在三角形级别进行裁剪](../.gitbook/assets/chapter-16image6.png)

对于每个既没有被接受也没有被丢弃的三角形，我们需要裁剪三角形本身。将原来的三角形移除，并添加一个
或两个新的三角形来覆盖裁剪体内部的三角形部分。

![在顶点级别进行裁剪，部位位于裁剪体内部的三角形被分割成一个或两个完全位于裁剪体内部的三角形](../.gitbook/assets/chapter-16image7.png)

## 定义裁剪平面

## 裁剪整个物体

## 裁剪三角形

## 裁剪过程的伪代码

## 渲染管线中的裁剪过程

## 代码实现

```html

```
