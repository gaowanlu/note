---
coverY: 0
---

# 第2章 传输层TCP、UDP、SCTP

## 传输层TCP、UDP、SCTP

### 未完待续

在此只是简单的了解下即可，后面对于每种协议还有具体的实践章节，到时候再进行展开学习  

1、简单介绍了TCP/IP协议栈中的协议，如BPF、DLPI、IGMP、ICMP、ARP、RARP、TCP、SCTP、UDP其IPV4、IPV6之间的联系  
2、TCP套接字是一种流套接字、UDP套接字是一种数据包套接字，TCP是面向连接的协议，UDP是一个无连接的协议  
4、IPV4网际协议版本4，32位地址  
5、IPV6网际协议版本6，128位地址  
3、用户数据报协议UDP：介绍了UDP的不可靠性，以及UDP无连接特性，使得客户端可以使用同一个套接字向不同服务端发送消息，服务端也可以从同一个套接字接收不同客户端发来的UDP数据报，接收到的UDP数据报是有固定长度的，这一点与TCP字节流协议没有任何记录边界的特性不同  
4、传输控制协议TCP：连接性、可靠性、确认机制、超时重传、往返时间RTT(round-trip time),对每个数据字节排序以至于滑动窗口机制的产生，流量控制机制、全双工  
5、流控制传输协议：SCTP有TCP的特性，不同的是SCTP是面向消息的和UDP一样一个一个消息传给上层，每个消息有自身大小，SCTP提供多个流，端点而且支持多个IP，使得当一个IP挂掉后，服务仍然可以工作得到可能  
6、TCP三次握手：介绍了socket相关函数如connect、bind、listen、accept与三次握手的关系，确认号和同步号的相关确认机制  
7、TCP选项：TCP_MAXSEG 发送SYN的TCP端告诉对方自己的最大分节大小、SO_RECVBUF窗口规模选项，时间戳选项  
8、TCP连接终止，介绍了server与client间close调用时机与read返回0与四次挥手之间各阶段的联系  
9、介绍了连接11种状态间的转换图，直观地分析三次握手与四次挥手之间的状态转换  
10、介绍了TCP分节MMS大小限制的握手交换，以及传输数据时的捎带确认(piggybacking)  
11、主动关闭的一端有一个特殊状态，TIME_WAIT状态，解释了两大原因，保证被动关闭方能够确保收到最后一个ACK、方面TIME_WAIT状态不允许，第二个理由就是中间的数据可能在路由中徘徊，因为超时重发机制早就又发了一次并且接收方已经收到过了，但是老的仍在徘徊，二者连接断开，然后又重新连接，此时可能徘徊的数据又走得通了，这样就造成了问题，上一次连接的数据可能到了这次新连接，网络中在2MSL内，所有没到达的数据都会在@2MSL内死去，所以TIME_WAIT保证了这一点  
12、SCTP连接：思路握手COOKIE确认机制，四次握手  
13、SCTP关联终止：三次挥手、没有TIME_WAIT阶段  
14、SCTP状态转换图、SCTP分组交换过程、SCTP选项  
15、端口号是16位整数，主要有三大类，1~1023IANA总所周知的端口、1024~49151IANA注册的端口、49152~65535IANA动态或私用端口  
16、套接字对：每个TCP连接的套接字对(本地IP、本机端口号、外地IP、外地端口号)，SCTP(一组本地IP、本机端口号、一组外地IP、外地端口号)，标识每个端点的两个值(IP和端口号)称为一个套接字  
17、TCP端口号与并发服务器，讲述套接字对的标识唯一连接的作用  
18、缓冲区大小及其限制：主要为IPV4数据报最大大小65535字节、IPV6最大65575字节、最大传输单元MTU、两主机之间路径最小的MTU称为路径MTU、IPV4主机对数据报切片、IPV4路由对数据报切片、IPV6主机对数据报切片，IPV6路由不切片，以及其他的一行大小影响  
19、TCP输出，write应用进程数据缓冲区与内核套接字发送缓冲区之间的阻塞状态下的关系，内核负责从套接字发送缓冲区，根据MSS大小进行TCP分节，通常MSS<=MTU ,然后网络层进行MTU大小的IPV4或IPV6分组，送到数据链路层队列，从write到返回只能说明所有数据都有到过内核缓冲区，并不能代表所有数据已经到达目的地了  
20、UDP输出：UDP套接字实际上没有内核发送缓冲区，只不过是内核一块内存空间，发送数据时直接从用户内存拷贝到内核内存，如果大于内核内存大小则内核返回给进程一个EMSGSIZE错误，且内核向下传递，UDP数据报到IP,网络层MTU大小的IPV4或IPV6分组，送入链路层队列，发送后队列中发送过的内容则进行删除，因为UDP是不可靠的  
21、SCTP输出：SCTP与TCP类似  
22、标准因特网服务，有一些TCP/UDP实现提供一些服务，如echo，time等服务等，但一般为了安全现通常被禁止  
23、常见使用协议如ping使用ICMP协议、traceroute使用ICMP与UDP协议，等等。
