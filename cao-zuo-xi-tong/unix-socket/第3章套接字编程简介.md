---
coverY: 0
---

# 第3章 套接字编程简介

## 套接字编程简介

### 未完待续

* IPV4套接字地址以sockaddr_in 命名，在netinet/in.h头文件中，有POSIX中的定义  
* 介绍了IPV4套接字地址结构、以及个字段的大小数据类型  
* 通用套接字地址结构、可以容下不同类型的套接字地址结构利用指针强转形式  
* IPV6套接字地址结构sockaddr_in6  
* 新的通用的套接字地址结构：sockaddr_storage,可以容下IPV4，IPV6，Unix，数据链路套接字地址结构  
* 套接字的地址API、一般都是传递地址，通知传递地址结构的内容大小，内核就知道改拷贝多少。还介绍了内核向进程传递套接字地址结构的方式  
* 字节排序：小端字节序，大端字节序，小端字节序内存地址越大是位高的字节，大端字节序内存地址越大是位低的字节  
* 字节排序函数：尝试使用union验证系统的主机字节序  
* uint16_t htons(uint16_t) unit32_t htonl(uint32_t) 返回网络字节序的值  

```cpp
#include <arpa/inet.h>
uint32_t htonl(uint32_t hostlong);
uint16_t htons(uint16_t hostshort);
uint32_t ntohl(uint32_t netlong);
uint16_t ntohs(uint16_t netshort);
```

* uint16_t ntohs(uint16_t) uint32_t ntonl(uint32_t) 返回主机字节序值  

```cpp
#include <arpa/inet.h>
uint32_t htonl(uint32_t hostlong);
uint16_t htons(uint16_t hostshort);
uint32_t ntohl(uint32_t netlong);
uint16_t ntohs(uint16_t netshort);
```

* 字节操纵函数：string.h bzero bcopy bcmp memset memcpy memcmp 的接口使用  

```cpp
#include <strings.h>
void bzero(void *s, size_t n);
void bcopy(const void *src, void *dest, size_t n);
int bcmp(const void *s1, const void *s2, size_t n);
void *memset(void *s, int c, size_t n);
void *memcpy(void *dest, const void *src, size_t n);
int memcmp(const void *s1, const void *s2, size_t n);
```

* 如何从字符串将IP地址转换为响应结构，inet_aton、inet_addr、inet_ntoa处理IPV6点分十进制数串、inet_pton与inet_ntop使用与IPV4和IPV6,了解包括其转换失败的处理等  

```cpp
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
int inet_aton(const char *cp, struct in_addr *inp);
in_addr_t inet_addr(const char *cp);
in_addr_t inet_network(const char *cp);
char *inet_ntoa(struct in_addr in);
struct in_addr inet_makeaddr(in_addr_t net, in_addr_t host);
in_addr_t inet_lnaof(struct in_addr in);
in_addr_t inet_netof(struct in_addr in);
```

* inet_pton与inet_ntop的函数参数详情、地址转换函数小结，整理了IP地址的字符以数值存储的转换处理  
* 了解inet_ntop与inet_ntop的与sockaddr_in sockaddr_in6 的sin_adrr sin6_addr字段的赋值操作、以及怎样封装自己的函数  
* 封装自己的sock_ntop函数，以及编写工具函数，比如绑定family、对比协议族、比较端口、获取端口、等等工具函数  
* read、write函数在套接字上的表现与通常文件不同，可能返回的数据比请求的大小要小，而且write可能回进入阻塞状态，而文件直接就可以写  
* 编写自己的工具类，readn、written、readline，保证一定可以做到readn、writen否则将按照错误处理  
* 了解readline的实现，以及readline工具函数采用缓冲的方式进行改进  
