---
coverY: 0
---

# 第 8 章 进程控制

## 进程控制

### 进程的基本知识

### 进程标识符 pid

pid_t 有符号 16 位、ps 命令、进程号是顺次向下使用、getpid()获取进程 id、getppid()获取父进程 id

```cpp
#include <sys/types.h>
#include <unistd.h>
pid_t getpid(void); //调用进程的进程id
pid_t getppid(void); //调用进程的父进程id
uid_t getuid(void); //调用进程的实际用户ID
uid_t geteuid(void); //调用进程的有效用户id
gid_t getgid(void); //调用进程的实际组id
gid_t getegid(void); //调用进程的有效组id
```

1、实际用户 ID 和实际用户组 ID：标识我是谁。也就是登录用户的 uid 和 gid，比如我的 Linux 以 simon 登录，在 Linux 运行的所有的命令的实际用户 ID 都是 simon 的 uid，实际用户组 ID 都是 simon 的 gid（可以用 id 命令查看）。

2、有效用户 ID 和有效用户组 ID：进程用来决定我们对资源的访问权限。一般情况下，有效用户 ID 等于实际用户 ID，有效用户组 ID 等于实际用户组 ID。当设置-用户-ID（SUID）位设置，则有效用户 ID 等于文件的所有者的 uid，而不是实际用户 ID；同样，如果设置了设置-用户组-ID（SGID）位，则有效用户组 ID 等于文件所有者的 gid，而不是实际用户组 ID。

```cpp
#include <iostream>
#include <sys/types.h>
#include <unistd.h>
using namespace std;
int main(int argc, char **argv)
{
    cout << "pid=" << getpid() << endl;
    cout << "ppid=" << getppid() << endl;
    cout << "uid=" << getuid() << endl;
    cout << "euid=" << geteuid() << endl;
    cout << "gid=" << getgid() << endl;
    cout << "egid=" << getegid() << endl;
    return 0;
}
// pid = 102 ppid = 10 uid = 1000 euid = 1000 gid = 1000 egid = 1000
```

### 进程的产生 fork(); vfork();

```cpp
#include <sys/types.h>
#include <unistd.h>
pid_t fork(void);
pid_t vfork(void);
```

duplicating 意味着拷贝克隆  
fork 后父子进程的区别：fork 返回值不同、pid 不同、ppid 不同、未决信号和文件锁不继承、资源利用量清零  
init 进程：是所有进程的祖先进程、PID=1

```cpp
#include <iostream>
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
using namespace std;
int main(int argc, char **argv)
{
    int val = 999;
    cout << "start" << endl;
    fflush(nullptr);
    pid_t pid = fork();
    if (pid < 0)
    {
        perror("pid<0");
    }
    else if (pid == 0) // 子进程
    {
        cout << val << "子进程 pid = " << pid << " ppid = " << getppid() << endl;
    }
    else // 父进程
    {
        cout << val << "父进程 pid = " << getpid() << endl;
    }
    return 0;
}
/*
start
999父进程 pid = 168
999子进程 pid = 0 ppid = 168
*/
```

进程并发小实例

```cpp
#include <iostream>
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
using namespace std;
#define RIGHT 3320
#define LEFT 3000

bool check(int val)
{
    bool res = true;
    for (int i = 2; i < val / 2; i++)
    {
        if (val % i == 0)
        {
            res = false;
            break;
        }
    }
    return res;
}

int main(int argc, char **argv)
{
    for (int i = LEFT; i <= RIGHT; i++)
    {
        int pid = fork();
        if (pid == 0)
        {
            if (check(i))
            {
                cout << i << endl;
            }
            return 0;
        }
    }
    return 0;
}
```

### init 进程与 vfork

### 进程 wait 与 waitpid

### 进程的消亡与资源释放

### exec 函数族

### 用户权限与组权限

### 解释器文件

### system();函数

### 进程会计

### 进程时间

### 守护进程

### 系统日志
